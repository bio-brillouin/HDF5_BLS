

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HDF5_BLS.wrapper &mdash; HDF5_BLS v1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
    <link rel="shortcut icon" href="../../_static/myicon.svg"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=76e2d817"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            HDF5_BLS
              <img src="../../_static/myicon.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/file_format.html">The file format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/hdf5_bls_package.html">The HDF5_BLS package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/HDF5_BLS.html">HDF5_BLS</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">HDF5_BLS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">HDF5_BLS.wrapper</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for HDF5_BLS.wrapper</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># from HDF5_BLS.load_data import load_general</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">HDF5_BLS.WrapperError</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">HDF5_BLS.load_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_general</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">HDF5_BLS.wrapper_compatibility</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">compat</span>
<span class="n">HDF5_BLS_Version</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>

<div class="viewcode-block" id="is_tempfile">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.is_tempfile">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_tempfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
    <span class="n">tempdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>
    <span class="c1"># Normalize paths for comparison</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="n">tempdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonpath</span><span class="p">([</span><span class="n">filepath</span><span class="p">,</span> <span class="n">tempdir</span><span class="p">])</span> <span class="o">==</span> <span class="n">tempdir</span></div>


<div class="viewcode-block" id="Wrapper">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Wrapper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This object is used to store data and attributes in a unified structure.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath: str</span>
<span class="sd">        The path to the HDF5 file</span>
<span class="sd">    need_for_repack: bool</span>
<span class="sd">        A flag to check wether elements were deleted in the file using the &quot;del&quot; method. If so, a repacking of the file is needed to optimize memory usage.</span>
<span class="sd">    save: bool</span>
<span class="sd">        A flag to check wether the file needs to be saved or not. If the file needs to be saved, it means that the user has worked on a temporary file located in the module directory, that will be deleted when the class is closed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">###############################</span>
    <span class="c1">#     General attributes      #</span>
    <span class="c1">###############################</span>
    <span class="n">BRILLOUIN_TYPES_DATASETS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Abscissa&quot;</span><span class="p">,</span> 
                                <span class="s2">&quot;Amplitude&quot;</span><span class="p">,</span> 
                                <span class="s2">&quot;Amplitude_err&quot;</span><span class="p">,</span> 
                                <span class="s2">&quot;BLT&quot;</span><span class="p">,</span> 
                                <span class="s2">&quot;BLT_err&quot;</span><span class="p">,</span> 
                                <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> 
                                <span class="s2">&quot;Linewidth&quot;</span><span class="p">,</span> 
                                <span class="s2">&quot;Linewidth_err&quot;</span><span class="p">,</span> 
                                <span class="s2">&quot;Other&quot;</span><span class="p">,</span> 
                                <span class="s2">&quot;PSD&quot;</span><span class="p">,</span> 
                                <span class="s2">&quot;Raw_data&quot;</span><span class="p">,</span> 
                                <span class="s2">&quot;Shift&quot;</span><span class="p">,</span> 
                                <span class="s2">&quot;Shift_err&quot;</span><span class="p">]</span>
    <span class="n">BRILLOUIN_TYPES_GROUPS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Calibration_spectrum&quot;</span><span class="p">,</span> <span class="s2">&quot;Impulse_response&quot;</span><span class="p">,</span> <span class="s2">&quot;Measure&quot;</span><span class="p">,</span> <span class="s2">&quot;Root&quot;</span><span class="p">,</span> <span class="s2">&quot;Treatment&quot;</span><span class="p">]</span>


    <span class="c1">##########################</span>
    <span class="c1">#     Magic methods      #</span>
    <span class="c1">##########################</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> <span class="c1"># Test made 15.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the wrapper. </span>
<span class="sd">        If no filepath is given, a temporary HDF5 file is created in the temporary directory of the operating system. A parent &quot;Brillouin&quot; group is then created and the attribute &quot;HDF5_BLS_version&quot; is set to the current version of the library.</span>
<span class="sd">        If a filepath is given but the file does not exist, it is created. A parent &quot;Brillouin&quot; group is then created and the attribute &quot;HDF5_BLS_version&quot; is set to the current version of the library.</span>
<span class="sd">        If a filepath is given and the file exists, it is opened and a compatibility check is performed. If the file is not compatible with the current version of the library, a series of changes are applied to make it compatible.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str, optional</span>
<span class="sd">            The filepath of the HDF5 file to load, by default None means that a temporary file is created in the temporary directory of the operating system.</span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; wrp = HDF5_BLS() # Creates a temporary HDF5 file in the temporary directory of the operating system</span>
<span class="sd">        &gt;&gt;&gt; wrp = HDF5_BLS(&quot;path/to/file.h5&quot;) # Creates a HDF5 file at the given path or opens an existing one at the given path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">no_filepath</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Function to run to initialize the class when no filepath is given. A temporary HDF5 file is created in the directory of the library. A parent &quot;Brillouin&quot; group is then created with the current version of the library. </span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Create a temporary file</span>
            <span class="n">fd</span><span class="p">,</span> <span class="n">filepath</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.h5&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>  <span class="c1"># Close the file descriptor</span>

            <span class="c1"># Create an HDF5 file with the base attributes at the temporary path</span>
            <span class="n">create_at_filepath</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">filepath</span>
        
        <span class="k">def</span><span class="w"> </span><span class="nf">create_at_filepath</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Function to run to initialize the class when a filepath is given. The HDF5 file is created at the given filepath. A parent &quot;Brillouin&quot; group is then created with the current version of the library. </span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            filepath : str</span>
<span class="sd">                The path to the location of the file</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            str</span>
<span class="sd">                The path to the location of the file</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">)</span>
                <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Root&quot;</span>
                <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;HDF5_BLS_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HDF5_BLS_Version</span>
            <span class="k">return</span> <span class="n">filepath</span>

        <span class="c1"># If no file are given, create a temporary HDF5 file with a single group &quot;Brillouin&quot;</span>
        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">no_filepath</span><span class="p">()</span>
        <span class="c1"># Opens the given file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If not already existing, creates it</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">create_at_filepath</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="c1"># else check for compatibility with current version of the module.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">filepath</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compatibility_changes</span><span class="p">()</span>
        <span class="c1"># Initializes saving flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Initializes repacking flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">need_for_repack</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="c1"># Test made 15.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Magic method to access the data of the wrapper</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            The path to the data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy array or closed h5py.Group</span>
<span class="sd">            The data or group corresponding to the path</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError_StructureError</span>
<span class="sd">            If the path does not lead to an element.    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; does not exist in the file.&quot;</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">item</span><span class="p">[()]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">key</span><span class="p">)[</span><span class="s2">&quot;MEASURE.Sampling_Matrix_Size_(Nx,Ny,Nz)_()&quot;</span><span class="p">]</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shape</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c1"># It would be better to return a new wrapper with only the selected group. But in this case we need to make sure that we will not overwrite temp.h5 by mistake.</span>
                    <span class="k">return</span> <span class="n">data</span>
            <span class="k">return</span> <span class="n">item</span>
        
    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="c1"># Test made 16.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Magic method to add two wrappers together</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : Wrapper</span>
<span class="sd">            The wrapper to add to the current wrapper</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Wrapper</span>
<span class="sd">            The wrapper resulting from the addition of the two wrappers</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError_FileNotFound</span>
<span class="sd">            If one of the two wrappers leads to a temporary file. </span>
<span class="sd">        WrapperError_StructureError</span>
<span class="sd">            If the two wrappers don&#39;t have the same version.</span>
<span class="sd">        WrapperError_Overwrite</span>
<span class="sd">            If the two wrappers share a group of same name.</span>
<span class="sd">        WrapperError</span>
<span class="sd">            If an error occured while adding the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create the new wrapper to return</span>
        <span class="n">new_wrapper</span> <span class="o">=</span> <span class="n">Wrapper</span><span class="p">()</span>

        <span class="c1"># Check if any of the filepathes of the two wrappers is a temporary filepath</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">==</span> <span class="n">new_wrapper</span><span class="o">.</span><span class="n">filepath</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">filepath</span> <span class="o">==</span> <span class="n">new_wrapper</span><span class="o">.</span><span class="n">filepath</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WrapperError_FileNotFound</span><span class="p">(</span><span class="s2">&quot;Please use wrappers that are not temporary and are saved on the disk.&quot;</span><span class="p">)</span>

        <span class="c1"># Checking the versions of the two files</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">version_self</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;HDF5_BLS_version&quot;</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">version_other</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;HDF5_BLS_version&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">version_self</span> <span class="o">!=</span> <span class="n">version_other</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="s2">&quot;The two files have different versions of the HDF5_BLS package.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Checking the structure of the two files to verify that the two files are compatible without overwriting</span>
        <span class="n">keys_self</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)[</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">keys_self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">)</span>
        <span class="n">keys_other</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">other</span><span class="o">.</span><span class="n">filepath</span><span class="p">)[</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">keys_other</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_other</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_Overwrite</span><span class="p">(</span><span class="s2">&quot;At least one group has the same name in the two files.&quot;</span><span class="p">)</span>
            
        <span class="c1"># Choosing the attributes to combine and the ones to assign to the individual groups</span>
        <span class="n">attr_combine</span><span class="p">,</span> <span class="n">attr_wrp1</span><span class="p">,</span> <span class="n">attr_wrp2</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>
        <span class="n">attributes_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">)</span>
        <span class="n">attributes_other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_attributes</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">attributes_self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">attributes_other</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">attributes_self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">attributes_other</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                    <span class="n">attr_combine</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">attributes_self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">attr_wrp1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">attributes_self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attr_wrp1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">attributes_self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">attributes_other</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">attributes_self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">attributes_self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="n">attributes_other</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                    <span class="n">attr_wrp2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">attributes_other</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attr_wrp2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">attributes_other</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        
        <span class="c1"># Creating the new file</span>
        <span class="c1"># try:</span>
        <span class="c1"># Combining the wrappers</span>
        <span class="n">keys1</span><span class="p">,</span> <span class="n">keys2</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>  
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">new_wrapper</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">new_file</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">new_file</span><span class="p">[</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">]</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">file</span><span class="p">[</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Brillouin/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                        <span class="n">new_file</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Brillouin/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> <span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                        <span class="n">keys2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">file</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Brillouin/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">file</span><span class="p">[</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Brillouin/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                        <span class="n">new_file</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Brillouin/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> <span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                        <span class="n">keys1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">file</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Brillouin/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>

        <span class="c1"># Adding common attributes to root              </span>
        <span class="n">new_wrapper</span><span class="o">.</span><span class="n">set_attributes_data</span><span class="p">(</span><span class="n">attributes</span><span class="o">=</span><span class="n">attr_combine</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Adding file-specific attributes to the each group that is added</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys1</span><span class="p">:</span>
            <span class="n">new_wrapper</span><span class="o">.</span><span class="n">set_attributes_data</span><span class="p">(</span><span class="n">attributes</span><span class="o">=</span><span class="n">attr_wrp1</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Brillouin/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys2</span><span class="p">:</span>
            <span class="n">new_wrapper</span><span class="o">.</span><span class="n">set_attributes_data</span><span class="p">(</span><span class="n">attributes</span><span class="o">=</span><span class="n">attr_wrp2</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Brillouin/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    
        <span class="c1"># except Exception as e:</span>
        <span class="c1">#     raise WrapperError(f&quot;A problem occured when adding the data to the file &#39;{self.filepath}&#39;. Error message: {e}&quot;)</span>
        
        <span class="n">new_wrapper</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">new_wrapper</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Magic method to print the structure of the wrapper</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The string representation of the structure of the wrapper</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">build_structure</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">lvl</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;Brillouin_type&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">tpe</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;|-&quot;</span> <span class="o">*</span> <span class="n">lvl</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">tpe</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">build_structure</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">lvl</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;|-&quot;</span> <span class="o">*</span> <span class="n">lvl</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">lines</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_structure</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">build_structure</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        

    <span class="c1">##########################</span>
    <span class="c1">#     Main methods       # </span>
    <span class="c1">##########################</span>

<div class="viewcode-block" id="Wrapper.add_hdf5">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.add_hdf5">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_hdf5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">parent_group</span> <span class="o">=</span> <span class="s2">&quot;Brillouin&quot;</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made 16.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds an HDF5 file to the wrapper by specifying in which group the data have to be stored. Default is the &quot;Brillouin&quot; group. If the specified group does not exist, it will be created.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str</span>
<span class="sd">            The filepath of the hdf5 file to add.</span>
<span class="sd">        parent_group : str, optional</span>
<span class="sd">            The parent group where to store the data of the HDF5 file, by default the parent group is the top group &quot;Brillouin&quot;. The format of this group should be &quot;Brillouin/Group/...&quot;. If the parent group does not exist, it will be created.</span>
<span class="sd">        overwrite : bool, optional</span>
<span class="sd">            A boolean that indicates whether the data should be overwritten if it already exists, by default False</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError_FileNotFound</span>
<span class="sd">            Raises an error if the file could not be found.</span>
<span class="sd">        WrapperError_StructureError</span>
<span class="sd">            Raises an error if the parent group does not exist in the HDF5 file.</span>
<span class="sd">        WrapperError_Overwrite</span>
<span class="sd">            Raises an error if the group already exists in the parent group.</span>
<span class="sd">        WrapperError</span>
<span class="sd">            Raises an error if the hdf5 file could not be added to the main HDF5 file.</span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; wrp = HDF5_BLS() # Creates a temporary HDF5 file in the temporary directory of the operating system</span>
<span class="sd">        &gt;&gt;&gt; wrp.add_hdf5(&quot;path/to/file.h5&quot;, &quot;Brillouin/Group&quot;) # Adds the HDF5 file at the given path to the &quot;Brillouin/Group&quot; group (which is here created)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">WrapperError_FileNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Extract the name of the h5 file that we want to add from its filepath</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Checks if the &quot;parent_group&quot; path exists in the file and if not choose the first parent group.</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="c1"># Check if the parent group exists</span>
            <span class="k">if</span> <span class="n">parent_group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">parent_group</span><span class="p">)</span>
            <span class="c1"># Check if the path leads to a group, if not, we go up one level</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">],</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                <span class="n">parent_group</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parent_group</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    
        <span class="c1"># Checks if the name of the HDF5 file we want to add is not already in the selected group. If so, check if overwrite is set to True. If so, overwrite. </span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_element</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">new_group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">new_group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Root&quot;</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">new_group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">new_group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Root&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_Overwrite</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A group with the name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; already exists in the parent group &#39;</span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Open the HDF5 file to add and copy all the elements located under the &quot;Brillouin&quot; group.</span>
                <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_copy</span><span class="p">:</span>
                    <span class="c1"># Try copying all the attributes of the HDF5 file to add to the group.</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">file_copy</span><span class="p">[</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">new_group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">file_copy</span><span class="p">[</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Brillouin/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                            <span class="n">file</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Brillouin/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> <span class="n">new_group</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">new_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">file_copy</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Brillouin/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A problem occured when adding the data to the file &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39;. Error message: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If the file was added to a temporary save, set the saving flag to True.</span>
        <span class="k">if</span> <span class="n">is_tempfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Wrapper.add_dictionnary">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.add_dictionnary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_dictionnary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dic</span><span class="p">,</span> <span class="n">parent_group</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name_group</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">brillouin_type</span> <span class="o">=</span> <span class="s2">&quot;Measure&quot;</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a data dictionnary to the wrapper. This is the preferred way to add data using the GUI.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dic : dict</span>
<span class="sd">            The data dictionnary. Support for the following keys:</span>
<span class="sd">            - &quot;Raw_data&quot;: the raw data</span>
<span class="sd">            - &quot;PSD&quot;: a power spectral density array</span>
<span class="sd">            - &quot;Frequency&quot;: a frequency array associated to the power spectral density</span>
<span class="sd">            - &quot;Abscissa_...&quot;: An abscissa array for the measures where the name is written after the underscore.</span>
<span class="sd">            Each of these keys can either be a numpy array or a dictionnary with two keys: &quot;Name&quot; and &quot;Data&quot;. The &quot;Name&quot; key is the name that will be given to the dataset, while the &quot;Data&quot; key is the data itself.</span>
<span class="sd">            The &quot;Abscissa_...&quot; keys are forced to link to a dictionnary with five keys: &quot;Name&quot;, &quot;Data&quot;, &quot;Unit&quot;, &quot;Dim_start&quot;, &quot;Dim_end&quot;. If the abscissa applies to dimension 1 for example, the &quot;Dim_start&quot; key should be set to 1, and the &quot;Dim_end&quot; to 2.</span>
<span class="sd">        parent_group : str, optional</span>
<span class="sd">            The path to the parent path, by default None</span>
<span class="sd">        name_group : str, optional</span>
<span class="sd">            The name of the data group, by default the name is &quot;Data_i&quot;.</span>
<span class="sd">        brillouin_type : str, optional            </span>
<span class="sd">            The type of the data group, by default the type is &quot;Measure&quot;. Other possible types are &quot;Calibration_spectrum&quot;, &quot;Impulse_response&quot;, ... Please refer to the documentation of the Brillouin software for more information.</span>
<span class="sd">        overwrite : bool, optional</span>
<span class="sd">            If set to True, any name in the file corresponding to an element to be added will be overwritten. Default is False</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------  </span>
<span class="sd">        WrapperError_StructureError</span>
<span class="sd">            Raises an error if the parent group does not exist in the HDF5 file.</span>
<span class="sd">        WrapperError_Overwrite</span>
<span class="sd">            Raises an error if the group already exists in the parent group.</span>
<span class="sd">        WrapperError_ArgumentType</span>
<span class="sd">            Raises an error if arguments given to the function do not match the expected type.</span>
<span class="sd">        WrapperError_AttributeError</span>
<span class="sd">            Raises an error if the keys of the dictionnary do not match the expected keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">only_parent</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># If the parent group is not specified, we set it to &quot;Brillouin&quot;, which is the top group of the file for Brillouin spectra</span>
        <span class="k">if</span> <span class="n">parent_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">parent_group</span> <span class="o">=</span> <span class="s2">&quot;Brillouin&quot;</span>
        <span class="c1"># If the parent group is specified, we perform checks to avoid overwriting the data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parent_group</span> <span class="o">==</span> <span class="n">name_group</span><span class="p">:</span>
                <span class="n">only_parent</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="c1"># Check if the parent group exists</span>
                <span class="k">if</span> <span class="n">parent_group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The parent group &#39;</span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">&#39; does not exist in the file.&quot;</span><span class="p">)</span>
                <span class="c1"># Check if the path leads to a group, if not, we go up one level</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">],</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                    <span class="n">parent_group</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parent_group</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># If the name is not specified, we set it by default to the &quot;Data_i&quot;</span>
        <span class="k">if</span> <span class="n">name_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="sa">f</span><span class="s2">&quot;Data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
                <span class="n">name_group</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">group</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">name_group</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">only_parent</span><span class="p">:</span> 
            <span class="k">pass</span>
        <span class="c1"># If the name is specified, we check if it already exists</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">name_group</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;Raw_data&quot;</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="n">name_group</span><span class="p">]:</span>
                                <span class="k">if</span> <span class="n">group</span><span class="p">[</span><span class="n">name_group</span><span class="p">][</span><span class="n">e</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Raw_data&quot;</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">delete_element</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name_group</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="k">raise</span> <span class="n">WrapperError_Overwrite</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A raw data is already in the group &#39;</span><span class="si">{</span><span class="n">name_group</span><span class="si">}</span><span class="s2">&#39; located at &#39;</span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
                                    <span class="k">break</span>
                        <span class="k">if</span> <span class="s2">&quot;Name&quot;</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">dic</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="n">name_group</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">delete_element</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name_group</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">dic</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">WrapperError_Overwrite</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A group with the name &#39;</span><span class="si">{</span><span class="n">name_group</span><span class="si">}</span><span class="s2">&#39; already exists in the parent group &#39;</span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">name_group</span><span class="p">,</span> <span class="n">parent_group</span><span class="o">=</span><span class="n">parent_group</span><span class="p">,</span> <span class="n">brillouin_type</span> <span class="o">=</span> <span class="s2">&quot;Measure&quot;</span><span class="p">)</span>

        <span class="c1"># Adding the data and the abscissa to the wrapper</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">only_parent</span><span class="p">:</span> 
                <span class="n">new_group</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_group</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">][</span><span class="n">name_group</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;Brillouin_type&quot;</span> <span class="ow">in</span> <span class="n">new_group</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="n">overwrite</span><span class="p">:</span> 
                <span class="n">new_group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">brillouin_type</span> <span class="c1"># We add the brillouin_type here to ensure overwrite</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="s2">&quot;Abscissa_&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Data&quot;</span><span class="p">,</span> <span class="s2">&quot;Unit&quot;</span><span class="p">,</span> <span class="s2">&quot;Dim_start&quot;</span><span class="p">,</span> <span class="s2">&quot;Dim_end&quot;</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="s2">&quot;The abscissa should be a dictionnary with the keys &#39;Name&#39;, &#39;Data&#39;, &#39;Unit&#39;, &#39;Dim_start&#39; and &#39;Dim_end&#39;.&quot;</span><span class="p">)</span>
                    
                    <span class="n">name_dataset</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span>
                    <span class="n">dataset</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name_dataset</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">]))</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Abscissa_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;Dim_start&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;Dim_end&quot;</span><span class="p">])</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;Unit&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">BRILLOUIN_TYPES_DATASETS</span><span class="p">:</span>
                    <span class="n">name_dataset</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">])</span>
                    <span class="n">dataset</span> <span class="o">=</span> <span class="n">new_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name_dataset</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;Attributes&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">new_group</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                                    <span class="n">new_group</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">new_group</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while adding the attribute </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> with value </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The key &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; is not recognized.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_tempfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Wrapper.add_dictionary">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.add_dictionary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dic</span><span class="p">,</span> <span class="n">parent_group</span><span class="p">,</span> <span class="n">create_group</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">brillouin_type_parent_group</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made 19.08.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a data dictionary to the wrapper. This is the preferred way to add data using the GUI.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dic : dict</span>
<span class="sd">            The data dictionary to add. The accepted keys for this dictionary are either the one given in the self.BRILLOUIN_TYPES_DATASET list, a key starting with &quot;Abscissa&quot; or &quot;Attributes&quot;.</span>
<span class="sd">            All the element of the dictionary are also dictionnaries.</span>
<span class="sd">            Except for attributes, each dictionary has at least two keys: &quot;Name&quot; and &quot;Data&quot;. If an abscissa is to be added, then the keys &quot;Dim_start&quot;, &quot;Dim_end&quot; and &quot;Units&quot; need to be populated. </span>
<span class="sd">            For attributes, each key is the name of the attribute, and the value is the value of the attribute, which will automatically be converted to string if it is not a string.</span>
<span class="sd">        parent_group : str, optional</span>
<span class="sd">            The path in the file where to store the dataset.</span>
<span class="sd">        brillouin_type_parent_group : str, optional            </span>
<span class="sd">            The type of the data group where the data are stored. This argument must be given if a new group is being created. If this argument is given and overwrite is set to True, then the brillouin type of the parent group will be overwritten. Otherwise, the original brillouin type of the parent group will be used.</span>
<span class="sd">        overwrite : bool, optional</span>
<span class="sd">            If set to True, any element of the file with a name corresponding to a name given in the dictionary will be overwritten. Similarly any existing argument will be overwritten and Brillouin type will be redefined. Default is False</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------  </span>
<span class="sd">        WrapperError_StructureError</span>
<span class="sd">            Raises an error if the parent group does not exist in the HDF5 file.</span>
<span class="sd">        WrapperError_Overwrite</span>
<span class="sd">            Raises an error if the group already exists in the parent group.</span>
<span class="sd">        WrapperError_ArgumentType</span>
<span class="sd">            Raises an error if arguments given to the function do not match the expected type.</span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; wrp = HDF5_BLS() # Creates a temporary HDF5 file in the temporary directory of the operating system</span>
<span class="sd">        &gt;&gt;&gt; dic = {&quot;Raw_data&quot;: {&quot;Name&quot;: &quot;Raw data&quot;, &quot;Data&quot;: np.random.random((50, 50, 512))}}</span>
<span class="sd">        &gt;&gt;&gt; wrp.add_dictionary(dic, parent_group = &quot;Brillouin/Group&quot;, create_group = True, brillouin_type_parent_group = &quot;Measure&quot;) # Adds the dictionary to the &quot;Brillouin/Group&quot; group (which is here created with Brillouin_type &quot;Measure&quot;)</span>
<span class="sd">        &gt;&gt;&gt; dic = {&quot;PSD&quot;: {&quot;Name&quot;: &quot;Power Spectral Density&quot;, &quot;Data&quot;: np.random.random((50, 50, 512))}, &quot;Frequency&quot;: {&quot;Name&quot;: &quot;Frequency&quot;, &quot;Data&quot;: np.arange(512)}}</span>
<span class="sd">        &gt;&gt;&gt; wrp.add_dictionary(dic, parent_group = &quot;Brillouin/Group&quot;, create_group = True, brillouin_type_parent_group = &quot;Measure&quot;) # Adds the PSD and Frequency arrays to &quot;Brillouin/Group&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">check_parent_group</span><span class="p">(</span><span class="n">parent_group</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="c1"># Check if parent group is in the file</span>
                <span class="k">if</span> <span class="n">parent_group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                    <span class="c1"># if not but &quot;create_group&quot; is True, create the group with the given Brillouin_type</span>
                    <span class="k">if</span> <span class="n">create_group</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">brillouin_type_parent_group</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">brillouin_type_parent_group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">BRILLOUIN_TYPES_GROUPS</span><span class="p">:</span>
                            <span class="n">group</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">parent_group</span><span class="p">)</span>
                            <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">brillouin_type_parent_group</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A valid Brillouin type must be given when a new group has to be created&quot;</span><span class="p">)</span>
                    <span class="c1"># else, raise an error</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The parent group &#39;</span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">&#39; does not exist in the HDF5 file.&quot;</span><span class="p">)</span>

                <span class="c1"># Check that the path leads to a group, if not, select the group above</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">],</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                    <span class="n">parent_group</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parent_group</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            
            <span class="k">return</span> <span class="n">parent_group</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">retrieve_brillouin_type</span><span class="p">(</span><span class="n">brillouin_type</span><span class="p">):</span>
            <span class="c1"># Retrieve existing Brillouin type is none was provided</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span>
                <span class="n">brillouin_type</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">brillouin_type</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">check_dictionary</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># Check that each key is a dictionary</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The element &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; is not a dictionary&quot;</span><span class="p">)</span>
                
                <span class="c1"># Check that each key has a valid brillouin_type</span>
                <span class="k">if</span> <span class="s2">&quot;Attribute&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">BRILLOUIN_TYPES_DATASETS</span> <span class="ow">and</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Abscissa&quot;</span><span class="p">:</span>
                    <span class="n">valid_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">BRILLOUIN_TYPES_DATASETS</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Abscissa&quot;</span><span class="p">]</span>
                    <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The key &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; does not exist. Valid keys are: </span><span class="si">{</span><span class="n">valid_keys</span><span class="si">}</span><span class="s2"> or &#39;Abscissa_i_j&#39;&quot;</span><span class="p">)</span>
                <span class="c1">#Check that if the key is an abscissa, the dictionary has the correct format</span>
                <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Abscissa&quot;</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span><span class="s2">&quot;Dim_end&quot;</span><span class="p">,</span><span class="s2">&quot;Dim_start&quot;</span><span class="p">,</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span><span class="s2">&quot;Units&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span><span class="s2">&quot;Dim_end&quot;</span><span class="p">,</span><span class="s2">&quot;Dim_start&quot;</span><span class="p">,</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span><span class="s2">&quot;Unit&quot;</span><span class="p">]:</span>
                            <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The key &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; does not have the correct format. It should be a dictionary with the following keys: &#39;Data&#39;, &#39;Dim_end&#39;, &#39;Dim_start&#39;, &#39;Name&#39;, &#39;Units&#39;&quot;</span><span class="p">)</span>
                <span class="c1"># Check that if the key is not an abscissa, the dictionary has the correct format</span>
                <span class="k">elif</span> <span class="s2">&quot;Attribute&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                    <span class="k">assert</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span><span class="s2">&quot;Name&quot;</span><span class="p">]),</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The key &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; does not have the correct format. It should be a dictionary with the following keys: &#39;Data&#39;, &#39;Name&#39;&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">check_raw_data</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                    <span class="n">elt</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">elt</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">elt</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Raw_data&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s2">&quot;Raw_data&quot;</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">delete_element</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">elt</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">WrapperError_Overwrite</span><span class="p">(</span><span class="s2">&quot;You cannot add another raw data to a group with an existing raw data&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">check_name</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="s2">&quot;Attribute&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">dic</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">delete_element</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">dic</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">WrapperError_Overwrite</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The name </span><span class="si">{</span><span class="n">dic</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2"> is already used in the group </span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Check that no issues come from the parent group and get the right parent group if a path to a dataset was given</span>
        <span class="n">parent_group</span> <span class="o">=</span> <span class="n">check_parent_group</span><span class="p">(</span><span class="n">parent_group</span><span class="p">)</span>

        <span class="c1"># Check that the brillouin_type is correct and get the brillouin type of the group if none was given</span>
        <span class="n">brillouin_type_parent_group</span> <span class="o">=</span> <span class="n">retrieve_brillouin_type</span><span class="p">(</span><span class="n">brillouin_type_parent_group</span><span class="p">)</span>

        <span class="c1"># Check that the dictionary has valid keys</span>
        <span class="n">check_dictionary</span><span class="p">()</span>

        <span class="c1"># Check that the user is not adding another raw data to a group with an existing raw data</span>
        <span class="n">check_raw_data</span><span class="p">()</span>

        <span class="c1"># Check that all the names given in the dictionary are free </span>
        <span class="n">check_name</span><span class="p">()</span>

        <span class="c1"># Add the data and the attributes to the file</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span>
            <span class="c1"># Go through the dictionary</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># If the key is a dataset type</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">BRILLOUIN_TYPES_DATASETS</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;Abscissa&quot;</span><span class="p">:</span>
                    <span class="c1"># If the key corresponds to a dataset that should be stored under a treatment group, check that the parent group as a Brillouin type &quot;Treatment&quot;</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">,</span> <span class="s2">&quot;Amplitude_err&quot;</span><span class="p">,</span> <span class="s2">&quot;BLT&quot;</span><span class="p">,</span> <span class="s2">&quot;BLT_err&quot;</span><span class="p">,</span> <span class="s2">&quot;Linewidth&quot;</span><span class="p">,</span> <span class="s2">&quot;Linewidth_err&quot;</span><span class="p">,</span> <span class="s2">&quot;Shift&quot;</span><span class="p">,</span> <span class="s2">&quot;Shift_err&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">brillouin_type_parent_group</span> <span class="o">==</span> <span class="s2">&quot;Treatment&quot;</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The brillouin_type &#39;</span><span class="si">{</span><span class="n">brillouin_type_parent_group</span><span class="si">}</span><span class="s2">&#39; should be &#39;Treatment&#39; if you want to add a dataset with type &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
                    <span class="c1"># If the key corresponds to a dataset that should be stored under a measurement group, check that the parent group as a Brillouin type &quot;Measure&quot;, &quot;Calibration_spectrum&quot; or &quot;Impulse_response&quot;</span>
                    <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;PSD&quot;</span><span class="p">,</span> <span class="s2">&quot;Raw_data&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">brillouin_type_parent_group</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Calibration_spectrum&quot;</span><span class="p">,</span> <span class="s2">&quot;Impulse_response&quot;</span><span class="p">,</span> <span class="s2">&quot;Measure&quot;</span><span class="p">]:</span>
                            <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The brillouin_type &#39;</span><span class="si">{</span><span class="n">brillouin_type_parent_group</span><span class="si">}</span><span class="s2">&#39; should be &#39;Calibration_spectrum&#39;, &#39;Impulse_response&#39; or &#39;Measure&#39; if you want to add a dataset with type &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
                    <span class="c1"># If everything is OK, create the dataset with the right Brillouin type</span>
                    <span class="n">dataset</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">])</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
                <span class="c1"># If the key is an attribute type</span>
                <span class="k">elif</span> <span class="s2">&quot;Attribute&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="c1"># Go through the attributes</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="c1"># If the attribute already exists and overwrite is set to True, modify it, if False, don&#39;t do anything</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">v</span><span class="p">:</span>
                                <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                        <span class="c1"># Else create the attribute</span>
                        <span class="k">elif</span> <span class="n">v</span><span class="p">:</span>
                            <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                <span class="c1"># If the key is an abscissa type</span>
                <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Abscissa&quot;</span><span class="p">:</span>
                    <span class="c1"># Create the dataset and give it the right Brillouin type</span>
                    <span class="n">dataset</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">])</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;Dim_start&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;Dim_end&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="c1"># Add the units as attribute</span>
                    <span class="k">if</span> <span class="s2">&quot;Units&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;Units&quot;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;Unit&quot;</span><span class="p">]</span></div>

                    
<div class="viewcode-block" id="Wrapper.change_brillouin_type">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.change_brillouin_type">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">change_brillouin_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">brillouin_type</span><span class="p">):</span> <span class="c1"># Test made 16.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Changes the brillouin type of an element in the HDF5 file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            The path to the element to change the brillouin type of.</span>
<span class="sd">        brillouin_type : str</span>
<span class="sd">            The new brillouin type of the element.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError_StructureError</span>
<span class="sd">            If the path is not a valid path.</span>
<span class="sd">        WrapperError_ArgumentType</span>
<span class="sd">            If the type is not valid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">check_path</span><span class="p">():</span>
            <span class="c1"># Check if the path is a valid path</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not exist in the file.&quot;</span><span class="p">)</span>
        
        <span class="n">check_path</span><span class="p">()</span>
        
        <span class="c1"># Check if the type is valid</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Group</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">brillouin_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">BRILLOUIN_TYPES_GROUPS</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The brillouin type &#39;</span><span class="si">{</span><span class="n">brillouin_type</span><span class="si">}</span><span class="s2">&#39; is not valid.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">brillouin_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">BRILLOUIN_TYPES_DATASETS</span> <span class="ow">and</span> <span class="n">brillouin_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Abscissa&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The brillouin type &#39;</span><span class="si">{</span><span class="n">brillouin_type</span><span class="si">}</span><span class="s2">&#39; is not valid.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Change the brillouin type</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">brillouin_type</span></div>


<div class="viewcode-block" id="Wrapper.change_name">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.change_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">change_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span> <span class="c1"># Test made 16.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Changes the name of an element in the HDF5 file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            The path to the element to change the name of.</span>
<span class="sd">        name : str</span>
<span class="sd">            The new name of the element.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError_StructureError</span>
<span class="sd">            If the path does not lead to an element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not exist in the file.&quot;</span><span class="p">)</span>
            <span class="n">new_path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">name</span>
            <span class="n">file</span><span class="p">[</span><span class="n">new_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_element</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>   </div>


<div class="viewcode-block" id="Wrapper.close">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.close">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delete_temp_file</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made 16.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Closes the wrapper and deletes the temporary file if it exists</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        delete_temp_file : bool, optional</span>
<span class="sd">            If True, the temporary file is deleted, by default False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the save flag is raised</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">:</span>
            <span class="c1"># If delete_temp_file is set to True and the file is temporary, the user wants to delete the temporary file without saving</span>
            <span class="k">if</span> <span class="n">delete_temp_file</span> <span class="ow">and</span> <span class="n">is_tempfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>
                    <span class="k">return</span>
            <span class="c1"># If the user has not expressly said he didn&#39;t want to save the file, we raise an error</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_Save</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The wrapper has not been saved yet.&quot;</span><span class="p">)</span>

        <span class="c1"># If the save flag is down but the need_for_repack is up, repack</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_for_repack</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repack</span><span class="p">()</span></div>


<div class="viewcode-block" id="Wrapper.combine_datasets">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.combine_datasets">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">combine_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">parent_group</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made 17.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combines a list of elements into a unique dataset. All the datasets must have the same shape. They are added into a new dataset where the first dimension is the number of datasets, under the group &quot;parent_group&quot;. If the dataset already exists and overwrite is set to True, it is overwritten.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        datasets : list of str</span>
<span class="sd">            The list of paths in the file to the datasets to combine</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the new dataset</span>
<span class="sd">        overwrite : bool, optional</span>
<span class="sd">            If a dataset with the same name already exists, overwrite it, by default False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if the datasets are in the file</span>
        <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">==</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The datasets &#39;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">&#39; are not datasets.&quot;</span><span class="p">)</span>

        <span class="c1"># Check if the name is not already in use</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parent_group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">parent_group</span><span class="p">)</span>
                <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Measure&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_children_elements</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">parent_group</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">WrapperError_Overwrite</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A dataset with the name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; already exists.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Checks that the datasets have the same shape</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">dataset</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
                <span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">dataset</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">shapes</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The datasets have different shapes.&quot;</span><span class="p">)</span>
    
        <span class="c1"># Create the new dataset</span>
        <span class="n">tpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">return_Brillouin_type</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">new_dataset</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">dataset</span><span class="p">][()]</span> <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">]</span>
        <span class="n">new_dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_dataset</span><span class="p">)</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="n">tpe</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                     <span class="s2">&quot;Data&quot;</span><span class="p">:</span> <span class="n">new_dataset</span><span class="p">}}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">add_dictionary</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">parent_group</span> <span class="o">=</span> <span class="n">parent_group</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.compatibility_changes">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.compatibility_changes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compatibility_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># Test made 17.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies changes from previous versions of the wrapper to newest versions using the compat module.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># Update the Brillouin_type attribute</span>
            <span class="n">f</span><span class="o">.</span><span class="n">visititems</span><span class="p">(</span><span class="n">compat</span><span class="o">.</span><span class="n">brillouin_type_update</span><span class="p">)</span>

            <span class="c1"># Update the HDF5_BLS_version attribute</span>
            <span class="n">f</span><span class="p">[</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;HDF5_BLS_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HDF5_BLS_Version</span></div>


<div class="viewcode-block" id="Wrapper.copy_dataset">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.copy_dataset">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">copy_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">copy_path</span><span class="p">):</span> <span class="c1"># Test made 17.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function allows to copy a dataset from the file to a different location while keeping the last location.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            The path to the dataset to copy.</span>
<span class="sd">        copy_path : str</span>
<span class="sd">            The path to the group where the dataset is to be copied to.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Checks that both the path to the dataset and the path to the group where to place the dataset are in the file</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not exist in the file.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">copy_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">copy_path</span><span class="si">}</span><span class="s2">&#39; does not exist in the file.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Copies the dataset to the desired location</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">new_name</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">file</span><span class="p">[</span><span class="n">copy_path</span><span class="p">]</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">new_name</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">][()])</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">file</span><span class="p">[</span><span class="n">copy_path</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">new_name</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">e</span><span class="p">]</span></div>


<div class="viewcode-block" id="Wrapper.create_group">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.create_group">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">brillouin_type</span> <span class="o">=</span> <span class="s2">&quot;Root&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made 17.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a group in the file under the given parent group with the given name and Brillouin type. If overwrite is set to True, if a group with the same name exists in the selected parent group, the previous element is removed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the group to create</span>
<span class="sd">        parent_group : str, optional</span>
<span class="sd">            The parent group where to create the group, by default the parent group is the top group &quot;Data&quot;. The format of this group should be &quot;Brillouin/Data&quot;</span>
<span class="sd">        brillouin_type : str, optional</span>
<span class="sd">            The type of the group, by default &quot;Root&quot;. Can be &quot;Root&quot;, &quot;Measure&quot;, &quot;Calibration_spectrum&quot;, &quot;Impulse_response&quot;, &quot;Treatment&quot;, &quot;Metadata&quot;</span>
<span class="sd">        overwrite : bool, optional</span>
<span class="sd">            If set to True, any name in the file corresponding to an element to be added will be overwritten. Default is False</span>
<span class="sd">            </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError</span>
<span class="sd">            If the group already exists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the path is not specified, we set it to the root of the file</span>
        <span class="k">if</span> <span class="n">parent_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">parent_group</span> <span class="o">=</span> <span class="s2">&quot;Brillouin&quot;</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="c1"># Check if the parent group exists</span>
            <span class="k">if</span> <span class="n">parent_group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The parent group &#39;</span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">&#39; does not exist in the HDF5 file.&quot;</span><span class="p">)</span>
            <span class="c1"># Check if a group of same name already exists</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">WrapperError_Overwrite</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A group with the name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; already exists in the parent group &#39;</span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delete_element</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">group</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">,</span> <span class="n">brillouin_type</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">,</span> <span class="n">brillouin_type</span><span class="p">)</span>

        <span class="c1"># If the file was temporary, we set the save flag to True</span>
        <span class="k">if</span> <span class="n">is_tempfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Wrapper.delete_element">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.delete_element">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">delete_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> <span class="c1"># Test made 17.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deletes an element from the file and sets the need_for_repack flag to True.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            The path to the element to delete</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError</span>
<span class="sd">            Raises an error if the path does not lead to an element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the path is not specified, we delete every element of the file and then create a new root Brillouin group.</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">file</span><span class="p">[</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_element</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Brillouin/</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">del</span> <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
                <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Root&quot;</span>
                <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;HDF5_BLS_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HDF5_BLS_Version</span>
            <span class="k">return</span>

        <span class="c1"># Check if the path leads to an element</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not lead to an element.&quot;</span><span class="p">)</span>
            <span class="c1"># If the path leads to an element, we delete it</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">WrapperError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occured while deleting the element &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;. Error message: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Set the need_for_repack flag to True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">need_for_repack</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Wrapper.export_dataset">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.export_dataset">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">export_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">export_type</span> <span class="o">=</span> <span class="s2">&quot;.npy&quot;</span><span class="p">):</span> <span class="c1"># Test made 17.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports the dataset at the given path as a numpy array.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            The path to the dataset to export. Warning: only datasets of 2 or less dimensions can be exported to either .csv or .xlsx formats.</span>
<span class="sd">        filepath : str</span>
<span class="sd">            The path to the numpy array to export to.</span>
<span class="sd">        export_type : str</span>
<span class="sd">            The type of export to perform (currently supported: &quot;.npy&quot;, &quot;.csv&quot;, &quot;.xlsx).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">export_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.npy&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">],</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The export type &#39;</span><span class="si">{</span><span class="n">export_type</span><span class="si">}</span><span class="s2">&#39; is not supported. Supported types are: &#39;.npy&#39;, &#39;.csv&#39;, &#39;.xlsx&#39;.&quot;</span><span class="p">)</span>

        <span class="c1"># Extract the dataset from the file</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">file</span><span class="p">,</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not exist in the file.&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">],</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">),</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not lead to a dataset.&quot;</span><span class="p">)</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">][()]</span>
        
        <span class="c1"># Ensure the filepath ends with the right extension</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">export_type</span><span class="p">):</span>
            <span class="n">filepath</span> <span class="o">+=</span> <span class="n">export_type</span>

        <span class="c1"># Export the dataset</span>
        <span class="k">if</span> <span class="n">export_type</span> <span class="o">==</span> <span class="s2">&quot;.npy&quot;</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">export_type</span> <span class="o">==</span> <span class="s2">&quot;.csv&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The dataset at path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; has more than 2 dimensions. Only datasets of 2 or less dimensions can be exported.&quot;</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">export_type</span> <span class="o">==</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The dataset at path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; has more than 2 dimensions. Only datasets of 2 or less dimensions can be exported.&quot;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.export_group">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.export_group">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">export_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made 18.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports the group at the given path as a HDF5 file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            The path to the group to export.</span>
<span class="sd">        filepath : str</span>
<span class="sd">            The path to the HDF5 file to export to.</span>
<span class="sd">        overwrite : bool</span>
<span class="sd">            A boolean to specify if the file we export to needs to be rewritten if it already exists.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Ensure the filepath ends with .h5</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.h5&quot;</span><span class="p">):</span>
            <span class="n">filepath</span> <span class="o">+=</span> <span class="s2">&quot;.h5&quot;</span>
        
        <span class="c1"># Ensure the path is a valid path</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not exist in the file.&quot;</span><span class="p">)</span>

        <span class="c1"># Check we&#39;re not trying to export datasets</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Group</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element at path: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> is not a group&quot;</span><span class="p">)</span>
        
        <span class="c1"># Check we&#39;re not trying to export a treatment group</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">return_Brillouin_type</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Treatment&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element at path: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> is a group of type Treatment.&quot;</span><span class="p">)</span>
        
        <span class="c1"># If the group to be exported is not of type &quot;Root&quot;, make sure to keep the name of the parent to wrap all children.</span>
        <span class="n">add_parent</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">return_Brillouin_type</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Root&quot;</span><span class="p">:</span>
            <span class="n">add_parent</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">Brillouin_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">return_Brillouin_type</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># If the filepath of export leads to an existing file and overwrite is True, delete existing file.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_Overwrite</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File at path: </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2"> already exists. Set overwrite to True to overwrite.&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">new_file</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">new_file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">)</span>
                <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Root&quot;</span>
                <span class="k">if</span> <span class="n">add_parent</span><span class="p">:</span>
                    <span class="n">new_file</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Brillouin/</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">new_file</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Brillouin/</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Brillouin_type</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_file</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">],</span> <span class="s2">&quot;Brillouin&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.export_image">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.export_image">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">export_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">simple_image</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">image_size</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">colorbar_label</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> <span class="c1"># Test made 18.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports the dataset at the given path as an image.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            The path to the dataset to export.</span>
<span class="sd">        filepath : str</span>
<span class="sd">            The path to the image to export to.</span>
<span class="sd">        simple_image : bool, optional</span>
<span class="sd">            If set to True, the image is exported as a simple image with grayscale colormap. If false, the image is exported with the given colormap and options.</span>
<span class="sd">        image_size : tuple, optional</span>
<span class="sd">            The size of the image to export. If None, the size is set to the default figure size.</span>
<span class="sd">        cmap : str, optional</span>
<span class="sd">            The colormap to use for the image. Default is &#39;viridis&#39;. All the available colormaps can be found here: https://matplotlib.org/stable/tutorials/colors/colormaps.html</span>
<span class="sd">        colorbar : bool, optional</span>
<span class="sd">            If set to True, a colorbar is added to the image.</span>
<span class="sd">        axis : boolean, optional</span>
<span class="sd">            If set to True, the image is displayed with an extent given by the &quot;MEASURE.Field_Of_View_(X,Y,Z)_(um)&quot; attribute. If set to False, the image is displayed without any extent.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">][()]</span>

            <span class="c1"># Reshape the element to avoid singleton dimensions</span>
            <span class="n">new_shape</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">new_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">simple_image</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Set the figure size</span>
                    <span class="k">if</span> <span class="n">image_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="n">image_size</span><span class="p">)</span>

                    <span class="c1"># Display the image</span>
                    <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">extent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)[</span><span class="s2">&quot;MEASURE.Field_Of_View_(X,Y,Z)_(um)&quot;</span><span class="p">]</span>
                        <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">extent</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
                        <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="n">extent</span><span class="p">)</span>
                    
                    <span class="c1"># Add a label to the x and y axis</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

                    <span class="c1"># Add a colorbar if needed</span>
                    <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">colorbar_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">colorbar_label</span><span class="p">)</span>

                    <span class="c1"># Save the image</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.get_attributes">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.get_attributes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="c1"># Test made 18.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the attributes associated to a given path. The attributes are retireved hierarchically, meaning that the attributes of all the groups above the given path are also retrieved, and their value is only changed if they are redefined at a lower level.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str, optional</span>
<span class="sd">            The path to the data, by default None which means the attributes are read from the root of the file (the Brillouin group).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attr : dict</span>
<span class="sd">            The attributes of the data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the path is not specified, we set it to the root of the file</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;Brillouin&quot;</span>

        <span class="c1"># We retrieve the paths of the attributes and store them in a list</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># We start by opening the file and going through the given path</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="c1"># If the element of the path does not exist, we raise an error</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not exist in the HDF5 file.&quot;</span><span class="p">)</span>
        
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">path_temp</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">file</span><span class="p">[</span><span class="n">path_temp</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
                <span class="n">attr</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">path_temp</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">path_temp</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">e</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">file</span><span class="p">[</span><span class="n">path_temp</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
                    <span class="n">attr</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">path_temp</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">attr</span></div>


<div class="viewcode-block" id="Wrapper.get_children_elements">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.get_children_elements">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_children_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Brillouin_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> <span class="c1"># Test made 18.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the children elements of a given path. If Brillouin_type is specified, only the children elements with the given Brillouin_type are returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str, optional</span>
<span class="sd">            The path to the element, by default None which means the root of the file (&quot;Brillouin&quot; group)</span>
<span class="sd">        Brillouin_type : str, optional</span>
<span class="sd">            The type of the element, by default None which means all the elements are returned</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The list of children elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;Brillouin&quot;</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">],</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                <span class="n">children</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">Brillouin_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">children</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">return_Brillouin_type</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="n">Brillouin_type</span><span class="p">]</span></div>


<div class="viewcode-block" id="Wrapper.get_special_groups_hierarchy">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.get_special_groups_hierarchy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_special_groups_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">brillouin_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> <span class="c1"># Test made 18.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all the groups with desired brillouin type that are hierarchically above a given path.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str, optional</span>
<span class="sd">            The path to the group, by default None which means the root group is used.</span>
<span class="sd">        brillouin_type : str, optional</span>
<span class="sd">            The type of the group, by default None which means &quot;Root&quot; is used</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The list of all the groups with desired brillouin type that are hierarchically above a given path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;Brillouin&quot;</span>
        <span class="k">if</span> <span class="n">brillouin_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">brillouin_type</span> <span class="o">=</span> <span class="s2">&quot;Root&quot;</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not exist in the file.&quot;</span><span class="p">)</span>

        <span class="c1"># Split the path into its components</span>
        <span class="n">path_split</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">path_temp</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#Create a list of all the groups with desired brillouin type that are hierarchically above a given path</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">path_split</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path_temp</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">path_temp</span> <span class="o">=</span> <span class="n">path_split</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">path_temp</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_temp</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">path_split</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">childs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_children_elements</span><span class="p">(</span><span class="n">path_temp</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">childs</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_temp</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">return_Brillouin_type</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="n">brillouin_type</span><span class="p">:</span>
                    <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_temp</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">groups</span></div>


<div class="viewcode-block" id="Wrapper.get_structure">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.get_structure">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="c1"># Test made 18.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the structure of an HDF5 file (by default the one stored in the object).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str, optional</span>
<span class="sd">            The filepath to the HDF5 file, by default None which means the filepath stored in the object is the one observed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The structure of the file with the types of each element in the &quot;Brillouin_type&quot; key.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError_StructureError</span>
<span class="sd">            Raises an error if one of the elements has no </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">iteration</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
            <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># Skip the structure key</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;Structure&quot;</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># If the key has the attribute &quot;Brillouin_type&quot;, we add it to the dictionary</span>
                    <span class="n">dic</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">:</span> <span class="n">file</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]}</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c1"># If the key does not have the attribute &quot;Brillouin_type&quot;, we set the default group type to &quot;Root&quot; and dataset type to &quot;Raw_data&quot;</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                        <span class="n">dic</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Root&quot;</span><span class="p">}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dic</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Raw_data&quot;</span><span class="p">}</span>
                <span class="c1"># If the element is a group, we iterate over it</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Metadata&quot;</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="n">iteration</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">temp</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">dic</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="n">iteration</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">structure</span></div>


<div class="viewcode-block" id="Wrapper.get_type">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.get_type">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_Brillouin_type</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made 18.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the type of the element</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str, optional</span>
<span class="sd">            The path to the element, by default None which means the root of the file (&quot;Brillouin&quot; group)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The type of the element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;Brillouin&quot;</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_Brillouin_type</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">])</span></div>


<div class="viewcode-block" id="Wrapper.move">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.move">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">):</span> <span class="c1"># Test made 19.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves an element from one path to another. If the new group does not exist, it is created.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            The path to the element to move.</span>
<span class="sd">        new_path : str</span>
<span class="sd">            The new path to move the element to.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError_StructureError</span>
<span class="sd">            If the path does not lead to an element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not exist in the file.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">new_path</span><span class="p">]</span>
            <span class="n">name_group</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">group</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">name_group</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">group</span><span class="p">[</span><span class="n">name_group</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">file</span><span class="p">[</span><span class="n">new_path</span><span class="p">][</span><span class="n">name_group</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">key</span><span class="p">],</span> <span class="n">key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_element</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.move_channel_dimension_to_last">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.move_channel_dimension_to_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move_channel_dimension_to_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">channel_dimension</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="c1"># Test made 19.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves the channel dimension to the last dimension of the data to comply with the HDF5_BLS convention.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            The path to the dataset to move the channel dimension to the last dimension.</span>
<span class="sd">        channel_dimension : int, optional</span>
<span class="sd">            The dimension of the channel. Default is None, which means the channel dimension is the last dimension.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if the path exists</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not exist in the file.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Check that the path leads to a dataset</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not lead to a dataset.&quot;</span><span class="p">)</span>

        <span class="c1"># Extract the data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>

        <span class="c1"># If nothing has to be done on the data (either no channel dimension or the channel dimension is the last dimension), return</span>
        <span class="k">if</span> <span class="n">channel_dimension</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">channel_dimension</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> 
        
        <span class="c1"># If the channel dimension is not the last dimension, move it to the last dimension</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">channel_dimension</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Replace the dataset, starting by extracting all its attributes, deleting the dataset and creating a new one</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_element</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span></div>


<div class="viewcode-block" id="Wrapper.repack">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.repack">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">repack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_repack</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made 19.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Repacks the wrapper to minimize its size.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        force_repack : bool</span>
<span class="sd">            Flag to force the repacking of the HDF5 file even if not necessary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">copy_group</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">new_file</span><span class="p">,</span> <span class="n">new_group</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Copies a group from one file to another.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            file : h5py.File</span>
<span class="sd">                The file to copy the group from.</span>
<span class="sd">            group : str</span>
<span class="sd">                The name of the group to copy.</span>
<span class="sd">            new_file : h5py.File</span>
<span class="sd">                The file to copy the group to.</span>
<span class="sd">            new_group : str</span>
<span class="sd">                The name of the group to copy to.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Create the new group</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">new_group</span><span class="p">)</span>

            <span class="c1"># Copy the attributes</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">file</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">new_file</span><span class="p">[</span><span class="n">new_group</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="c1"># Copy the data</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">file</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">key</span><span class="p">],</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                    <span class="n">copy_group</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">group</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="p">,</span> <span class="n">new_file</span><span class="p">,</span> <span class="n">new_group</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dataset</span> <span class="o">=</span> <span class="n">new_file</span><span class="p">[</span><span class="n">new_group</span><span class="p">]</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">file</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">key</span><span class="p">])</span>
                    <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_for_repack</span> <span class="ow">or</span> <span class="n">force_repack</span><span class="p">:</span>
            <span class="c1"># Create a blank HDF5 file to store the data</span>
            <span class="n">temporary_file</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mktemp</span><span class="p">(</span><span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;.h5&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">temporary_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;Brillouin&quot;</span><span class="p">)</span>
                <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Root&quot;</span>
                <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;HDF5_BLS_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HDF5_BLS_Version</span>

            <span class="c1"># Create a new file to store the data</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_old</span><span class="p">:</span>
                <span class="c1"># Create a new file to store the data</span>
                <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">temporary_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">new_file</span><span class="p">:</span>
                    <span class="c1"># Copy the data and attributes from the wrapper to the new file</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">file_old</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">copy_group</span><span class="p">(</span><span class="n">file_old</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">new_file</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        
            <span class="c1"># Delete the old file</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>

            <span class="c1"># Rename the new file to the old file</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">temporary_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>

            <span class="c1"># Set the need_for_repack flag to False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">need_for_repack</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Wrapper.save_as_hdf5">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.save_as_hdf5">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_as_hdf5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_old_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made 19.09.25</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves the data and attributes to an HDF5 file. In practice, moves the temporary hdf5 file to a new location and removes the old file if specified.</span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str, optional</span>
<span class="sd">            The filepath where to save the hdf5 file. Default is None, which means the file is saved in the same location as the current file.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        WrapperError_Overwrite</span>
<span class="sd">            If the file already exists.</span>
<span class="sd">        WrapperError</span>
<span class="sd">            Raises an error if the file could not be saved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the filepath is the same as the current one, we do nothing</span>
        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">filepath</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="c1"># If the filepath is not the same as the current one, we move the current file to the new location </span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WrapperError_Overwrite</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39; already exists.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Copy the current file to the new location and update filepath attribute</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">src_file</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst_file</span><span class="p">:</span>
                    <span class="n">src_file</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s1">&#39;/Brillouin&#39;</span><span class="p">,</span> <span class="n">dst_file</span><span class="p">)</span>
            <span class="c1"># Remove the old file if specified</span>
            <span class="k">if</span> <span class="n">remove_old_file</span><span class="p">:</span> 
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">filepath</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WrapperError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occured while saving the file &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39;. Error message: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Wrapper.save_properties_csv">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.save_properties_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_properties_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves the attributes of the data in the HDF5 file to a CSV file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str</span>
<span class="sd">            The filepath to the csv storing the properties of the measure. </span>
<span class="sd">        path : str, optional</span>
<span class="sd">            The path to the data in the HDF5 file, by default None leads to the top group &quot;Brillouin&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;Brillouin&quot;</span>
        
        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
            <span class="n">base</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;HDF5_BLS_version&quot;</span><span class="p">]])</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">,</span> <span class="s2">&quot;HDF5_BLS_version&quot;</span><span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">base</span><span class="p">:</span>
                    <span class="n">base</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">])</span>
                    <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">base</span><span class="p">])</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span></div>


<div class="viewcode-block" id="Wrapper.set_attributes_data">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.set_attributes_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_attributes_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the attributes of the data in the HDF5 file. If the path leads to a dataset, the attributes are added to the group containing the dataset. If overwrite is False, the attributes are not overwritten if they already exist.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        attributes : dict</span>
<span class="sd">            The attributes to be added to the HDF5 file. in the form {&quot;MEASURE.Sample&quot;: &quot;Water&quot;, ...}</span>
<span class="sd">        path : str, optional</span>
<span class="sd">            The path to the dataset or group in the HDF5 file, by default None leads to the top group &quot;Brillouin&quot;</span>
<span class="sd">        overwrite : bool, optional</span>
<span class="sd">            A parameter to indicate whether the attributes should be overwritten if they already exist or not, by default False - attributes are not overwritten.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the path is not specified, we set it to the root of the file</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;Brillouin&quot;</span>

        <span class="c1"># Updating the attributes</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span>  <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span> 
                <span class="k">raise</span> <span class="n">WrapperError_StructureError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not lead to an element.&quot;</span><span class="p">)</span>
            <span class="c1"># If the path leads to a dataset, we go up one level to get a group</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">])</span> <span class="ow">is</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># We update the attributes of the metadata group taking into account the &quot;update&quot; parameter</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">v</span><span class="p">:</span>
                            <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">v</span><span class="p">:</span>
                        <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrapperError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occured while updating the metadata of the HDF5 file.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_tempfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">True</span></div>



    <span class="c1">##########################</span>
    <span class="c1">#    Derived methods     #</span>
    <span class="c1">##########################</span>

<div class="viewcode-block" id="Wrapper.add_abscissa">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.add_abscissa">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_abscissa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">parent_group</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;AU&quot;</span><span class="p">,</span> <span class="n">dim_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dim_end</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds abscissa as a dataset to the &quot;parent_group&quot; group. </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : np.ndarray</span>
<span class="sd">            The array corresponding to the abscissa that is to be addedto the wrapper.</span>
<span class="sd">        parent_group : str, optional</span>
<span class="sd">            The parent group where to store the data of the HDF5 file, by default the parent group is the top group &quot;Data&quot;. The format of this group should be &quot;Brillouin/Measure&quot;.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The name of that is given to the abscissa dataset. If the name is not specified, it is set to &quot;Abscissa_{dim_start}_{dim_end}&quot;</span>
<span class="sd">        unit: str, optional</span>
<span class="sd">            The unit of the abscissa array, by default AU for Arbitrary Units</span>
<span class="sd">        dim_start: int, optional</span>
<span class="sd">            The first dimension of the abscissa array, by default 0</span>
<span class="sd">        dim_end: int, optional</span>
<span class="sd">            The last dimension of the abscissa array, by default the last number of dimension of the array</span>
<span class="sd">        overwrite : bool, optional </span>
<span class="sd">            A parameter to indicate whether the group should be overwritten if they already exist or not, by default False - attributes are not overwritten. </span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError_StructureError</span>
<span class="sd">            If the parent group does not exist in the HDF5 file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dim_end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">dim_end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">dim_start</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dim_end</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Abscissa_&quot;</span><span class="p">:{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> 
                           <span class="s2">&quot;Data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> 
                           <span class="s2">&quot;Unit&quot;</span><span class="p">:</span> <span class="n">unit</span><span class="p">,</span> 
                           <span class="s2">&quot;Dim_start&quot;</span><span class="p">:</span> <span class="n">dim_start</span><span class="p">,</span> 
                           <span class="s2">&quot;Dim_end&quot;</span><span class="p">:</span> <span class="n">dim_end</span><span class="p">}}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">add_dictionary</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> 
                            <span class="n">parent_group</span> <span class="o">=</span> <span class="n">parent_group</span><span class="p">,</span> 
                            <span class="n">create_group</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                            <span class="n">brillouin_type_parent_group</span><span class="o">=</span><span class="s2">&quot;Measure&quot;</span><span class="p">,</span> 
                            <span class="n">overwrite</span> <span class="o">=</span> <span class="n">overwrite</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.add_attributes">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.add_attributes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">parent_group</span> <span class="o">=</span> <span class="s2">&quot;Brillouin&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds attributes to the wrapper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        attributes : dict</span>
<span class="sd">            The attributes to add to the wrapper. The keys of the dictionary should be the name of the attributes, and the values should be the values of the attributes.</span>
<span class="sd">        parent_group : str, optional</span>
<span class="sd">            The parent group where to store the attributes of the HDF5 file. The format of this group should be &quot;Brillouin/Measure&quot;. By default parent_group is set to &quot;Brillouin&quot;.</span>
<span class="sd">        overwrite : bool, optional</span>
<span class="sd">            If True, the attributes will be overwritten if they already exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Attributes&quot;</span><span class="p">:</span> <span class="n">attributes</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_dictionary</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> 
                            <span class="n">create_group</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">brillouin_type_parent_group</span><span class="o">=</span><span class="s2">&quot;Root&quot;</span><span class="p">,</span>
                            <span class="n">parent_group</span> <span class="o">=</span> <span class="n">parent_group</span><span class="p">,</span> 
                            <span class="n">overwrite</span> <span class="o">=</span> <span class="n">overwrite</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.add_frequency">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.add_frequency">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">parent_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a frequency array to the wrapper by creating a new group.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : np.ndarray</span>
<span class="sd">            The frequency array to add to the wrapper.</span>
<span class="sd">        parent_group : str, optional</span>
<span class="sd">            The parent group where to store the data of the HDF5 file. The format of this group should be &quot;Brillouin/Measure&quot;.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The name of the frequency dataset we want to add, and as it will be displayed in the file by any HDF5 viewer. By default the name is &quot;Frequency&quot;.</span>
<span class="sd">        overwrite : bool, optional </span>
<span class="sd">            A parameter to indicate whether the dataset should be overwritten if a dataset with same name already exist or not, by default False - not overwritten. </span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError_StructureError</span>
<span class="sd">            If the parent group does not exist in the HDF5 file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Frequency&quot;</span>

        <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Frequency&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> 
                             <span class="s2">&quot;Data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}}</span>  
        
        <span class="bp">self</span><span class="o">.</span><span class="n">add_dictionary</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> 
                            <span class="n">parent_group</span> <span class="o">=</span> <span class="n">parent_group</span><span class="p">,</span> 
                            <span class="n">create_group</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                            <span class="n">brillouin_type_parent_group</span><span class="o">=</span><span class="s2">&quot;Measure&quot;</span><span class="p">,</span> 
                            <span class="n">overwrite</span> <span class="o">=</span> <span class="n">overwrite</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.add_PSD">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.add_PSD">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_PSD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">parent_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a PSD array to the wrapper by creating a new group.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : np.ndarray</span>
<span class="sd">            The PSD array to add to the wrapper.</span>
<span class="sd">        parent_group : str, optional</span>
<span class="sd">            The parent group where to store the data of the HDF5 file. The format of this group should be &quot;Brillouin/Measure&quot;.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The name of the frequency dataset we want to add, and as it will be displayed in the file by any HDF5 viewer. By default the name is &quot;PSD&quot;.</span>
<span class="sd">        overwrite : bool, optional </span>
<span class="sd">            A parameter to indicate whether the dataset should be overwritten if a dataset with same name already exist or not, by default False - not overwritten. </span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError_StructureError</span>
<span class="sd">            If the parent group does not exist in the HDF5 file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;PSD&quot;</span>

        <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;PSD&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> 
                       <span class="s2">&quot;Data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}}</span>  
        
        <span class="bp">self</span><span class="o">.</span><span class="n">add_dictionary</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> 
                            <span class="n">parent_group</span> <span class="o">=</span> <span class="n">parent_group</span><span class="p">,</span> 
                            <span class="n">create_group</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                            <span class="n">brillouin_type_parent_group</span><span class="o">=</span><span class="s2">&quot;Measure&quot;</span><span class="p">,</span> 
                            <span class="n">overwrite</span> <span class="o">=</span> <span class="n">overwrite</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.add_raw_data">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.add_raw_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_raw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">parent_group</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a raw data array to the wrapper by creating a new group.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : np.ndarray</span>
<span class="sd">            The raw data array to add to the wrapper.</span>
<span class="sd">        parent_group : str, optional</span>
<span class="sd">            The parent group where to store the data of the HDF5 file. The format of this group should be &quot;Brillouin/Measure&quot;.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The name of the frequency dataset we want to add, and as it will be displayed in the file by any HDF5 viewer. By default the name is &quot;Raw data&quot;.</span>
<span class="sd">        overwrite : bool, optional </span>
<span class="sd">            A parameter to indicate whether the dataset should be overwritten if a dataset with same name already exist or not, by default False - not overwritten. </span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError_StructureError</span>
<span class="sd">            If the parent group does not exist in the HDF5 file.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Raw data&quot;</span>

        <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Raw_data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> 
                            <span class="s2">&quot;Data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}}</span>  

        <span class="bp">self</span><span class="o">.</span><span class="n">add_dictionary</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> 
                            <span class="n">parent_group</span> <span class="o">=</span> <span class="n">parent_group</span><span class="p">,</span> 
                            <span class="n">create_group</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                            <span class="n">brillouin_type_parent_group</span><span class="o">=</span><span class="s2">&quot;Measure&quot;</span><span class="p">,</span> 
                            <span class="n">overwrite</span> <span class="o">=</span> <span class="n">overwrite</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.add_treated_data">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.add_treated_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_treated_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_group</span><span class="p">,</span> <span class="n">name_group</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="c1"># Test made, Dev guide made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds the arrays resulting from the treatment of the PSD to the wrapper by creating a new group.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parent_group : str, optional</span>
<span class="sd">            The parent group where to store the data of the HDF5 file. The format of this group should be &quot;Brillouin/Measure&quot;.</span>
<span class="sd">        name_group : str, optional</span>
<span class="sd">            The name of the group that will be created to store the treated data. By default the name is &quot;Treat_i&quot; with i the number of the treatment so that the name is unique.</span>
<span class="sd">        overwrite : bool, optional </span>
<span class="sd">            A parameter to indicate whether the dataset should be overwritten if a dataset with same name already exist or not, by default False - not overwritten. </span>
<span class="sd">        shift: np.ndarray, optional</span>
<span class="sd">            The shift array to add to the wrapper.</span>
<span class="sd">        linewidth: np.ndarray, optional</span>
<span class="sd">            The linewidth array to add to the wrapper.</span>
<span class="sd">        amplitude: np.ndarray, optional</span>
<span class="sd">            The amplitude array to add to the wrapper.</span>
<span class="sd">        blt: np.ndarray, optional</span>
<span class="sd">            The Loss Tangent array to add to the wrapper.</span>
<span class="sd">        shift_err: np.ndarray, optional</span>
<span class="sd">            The shift error array to add to the wrapper.</span>
<span class="sd">        linewidth_err: np.ndarray, optional</span>
<span class="sd">            The linewidth error array to add to the wrapper.</span>
<span class="sd">        amplitude_err: np.ndarray, optional </span>
<span class="sd">            The amplitude error array to add to the wrapper.</span>
<span class="sd">        blt_std: np.ndarray, optional   </span>
<span class="sd">            The Loss Tangent error array to add to the wrapper.</span>
<span class="sd">            </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError_StructureError</span>
<span class="sd">            If the parent group does not exist in the HDF5 file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shift&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shift</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;Shift&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shift&quot;</span><span class="p">,</span> <span class="s2">&quot;Data&quot;</span><span class="p">:</span> <span class="n">shift</span><span class="p">}</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linewidth&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;Linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;Linewidth&quot;</span><span class="p">,</span> <span class="s2">&quot;Data&quot;</span><span class="p">:</span> <span class="n">linewidth</span><span class="p">}</span>
        <span class="n">amplitude</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;amplitude&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">amplitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;Amplitude&quot;</span><span class="p">,</span> <span class="s2">&quot;Data&quot;</span><span class="p">:</span> <span class="n">amplitude</span><span class="p">}</span>
        <span class="n">blt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;blt&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">blt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;BLT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;BLT&quot;</span><span class="p">,</span> <span class="s2">&quot;Data&quot;</span><span class="p">:</span> <span class="n">blt</span><span class="p">}</span>
        <span class="n">shift_err</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shift_err&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shift_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;Shift_err&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shift error&quot;</span><span class="p">,</span> <span class="s2">&quot;Data&quot;</span><span class="p">:</span> <span class="n">shift_err</span><span class="p">}</span>
        <span class="n">linewidth_err</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linewidth_err&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">linewidth_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;Linewidth_err&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;Linewidth error&quot;</span><span class="p">,</span> <span class="s2">&quot;Data&quot;</span><span class="p">:</span> <span class="n">linewidth_err</span><span class="p">}</span>
        <span class="n">amplitude_err</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;amplitude_err&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">amplitude_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;Amplitude_err&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;Amplitude error&quot;</span><span class="p">,</span> <span class="s2">&quot;Data&quot;</span><span class="p">:</span> <span class="n">amplitude_err</span><span class="p">}</span>
        <span class="n">blt_std</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;blt_std&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">blt_std</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;BLT_err&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;BLT error&quot;</span><span class="p">,</span> <span class="s2">&quot;Data&quot;</span><span class="p">:</span> <span class="n">blt_std</span><span class="p">}</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_dictionary</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> 
                            <span class="n">parent_group</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_group</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name_group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> 
                            <span class="n">create_group</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                            <span class="n">brillouin_type_parent_group</span><span class="o">=</span><span class="s2">&quot;Treatment&quot;</span><span class="p">,</span> 
                            <span class="n">overwrite</span> <span class="o">=</span> <span class="n">overwrite</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.clear_empty_attributes">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.clear_empty_attributes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clear_empty_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deletes all the attributes that are empty at the given path.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            The path to the element to delete the attributes from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Group</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_empty_attributes</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span></div>


<div class="viewcode-block" id="Wrapper.import_raw_data">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.import_raw_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">import_raw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">parent_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">creator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reshape</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a raw data array to the HDF5 file from a file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str</span>
<span class="sd">            The filepath to the raw data file to import.</span>
<span class="sd">        parent_group : str, optional</span>
<span class="sd">            The parent group where to store the data of the HDF5 file. The format of this group should be &quot;Brillouin/Measure&quot;.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The name of the dataset, by default None.</span>
<span class="sd">        creator : str, optional</span>
<span class="sd">            The structure of the file that has to be loaded. If None, a LoadError can be raised.</span>
<span class="sd">        parameters : dict, optional</span>
<span class="sd">            The parameters that are to be used to import the data correctly.  If None, a LoadError can be raised.</span>
<span class="sd">        reshape : tuple, optional</span>
<span class="sd">            The new shape of the array, by default None means that the shape is not changed</span>
<span class="sd">        overwrite : bool, optional </span>
<span class="sd">            A parameter to indicate whether the dataset should be overwritten if a dataset with same name already exist or not, by default False - not overwritten. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">WrapperError_FileNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>

        <span class="n">dic</span> <span class="o">=</span> <span class="n">load_general</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span>
                            <span class="n">creator</span><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
                            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">reshape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;Raw_data&quot;</span><span class="p">][</span><span class="s2">&quot;Data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s2">&quot;Raw_data&quot;</span><span class="p">][</span><span class="s2">&quot;Data&quot;</span><span class="p">],</span> <span class="n">reshape</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">add_raw_data</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s2">&quot;Raw_data&quot;</span><span class="p">][</span><span class="s2">&quot;Data&quot;</span><span class="p">],</span> <span class="n">parent_group</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="n">overwrite</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.import_other">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.import_other">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">import_other</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">parent_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">creator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reshape</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a raw data array to the wrapper from a file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str</span>
<span class="sd">            The filepath to the raw data file to import.</span>
<span class="sd">        parent_group : str, optional</span>
<span class="sd">            The parent group where to store the data of the HDF5 file. The format of this group should be &quot;Brillouin/Measure&quot;.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The name of the dataset, by default None.</span>
<span class="sd">        creator : str, optional</span>
<span class="sd">            The structure of the file that has to be loaded. If None, a LoadError can be raised.</span>
<span class="sd">        parameters : dict, optional</span>
<span class="sd">            The parameters that are to be used to import the data correctly.  If None, a LoadError can be raised.</span>
<span class="sd">        reshape : tuple, optional</span>
<span class="sd">            The new shape of the array, by default None means that the shape is not changed</span>
<span class="sd">        overwrite : bool, optional </span>
<span class="sd">            A parameter to indicate whether the dataset should be overwritten if a dataset with same name already exist or not, by default False - not overwritten. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">WrapperError_FileNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">while</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
                
        <span class="n">dic</span> <span class="o">=</span> <span class="n">load_general</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span>
                            <span class="n">creator</span><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
                            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
                            <span class="n">brillouin_type</span> <span class="o">=</span> <span class="s2">&quot;Other&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">reshape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;Other&quot;</span><span class="p">][</span><span class="s2">&quot;Data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s2">&quot;Other&quot;</span><span class="p">][</span><span class="s2">&quot;Data&quot;</span><span class="p">],</span> <span class="n">reshape</span><span class="p">)</span>
        <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;Other&quot;</span><span class="p">][</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_dictionary</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">parent_group</span> <span class="o">=</span> <span class="n">parent_group</span><span class="p">,</span> <span class="n">create_group</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">brillouin_type_parent_group</span> <span class="o">=</span> <span class="s2">&quot;Measure&quot;</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="n">overwrite</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.import_properties_data">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.import_properties_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">import_properties_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">delete_child_attributes</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Imports properties from an excel or CSV file into a dictionary.</span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str                           </span>
<span class="sd">            The filepath to the csv storing the properties of the measure. This csv is based on the spreadsheet found in the &quot;spreadsheet&quot; folder of the repository.</span>
<span class="sd">        path : str</span>
<span class="sd">            The path to the data in the HDF5 file.</span>
<span class="sd">        overwrite : bool, optional</span>
<span class="sd">            A boolean that indicates whether the attributes should be overwritten if they already exist, by default False.</span>
<span class="sd">        delete_child_attributes : bool, optional</span>
<span class="sd">            If True, all the attributes of the children elements with same name as the ones to be updated are deleted. Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">delete_attributes</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Group</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">file</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_children_elements</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">delete_attributes</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># Check if the filepath leads to a valid csv file</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span> <span class="s1">&#39;.xls&#39;</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">WrapperError_FileNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39; is not a valid CSV file.&quot;</span><span class="p">)</span>
        <span class="c1"># Check if the file exists</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">WrapperError_FileNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>

        <span class="c1"># If the path is not given, we set it to the root of the file</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;Brillouin&quot;</span>

        <span class="c1"># Extracting the attributes from the attributes file</span>
        <span class="n">new_attributes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">filepath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_file</span><span class="p">:</span>
                <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;FILEPROP&quot;</span><span class="p">,</span> <span class="s2">&quot;SPECTROMETER&quot;</span><span class="p">,</span> <span class="s2">&quot;MEASURE&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">new_attributes</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">filepath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filepath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xls&#39;</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;FILEPROP&quot;</span><span class="p">,</span> <span class="s2">&quot;SPECTROMETER&quot;</span><span class="p">,</span> <span class="s2">&quot;MEASURE&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                            <span class="n">new_attributes</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WrapperError_FileNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39; is not a valid CSV, XLSX or XLS file.&quot;</span><span class="p">)</span>

        <span class="c1"># Delete the attributes of the children elements with same name as the ones to be updated</span>
        <span class="k">if</span> <span class="n">delete_child_attributes</span><span class="p">:</span>
            <span class="n">delete_attributes</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">new_attributes</span><span class="p">)</span>

        <span class="c1"># Updating the attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_dictionary</span><span class="p">({</span><span class="s2">&quot;Attributes&quot;</span><span class="p">:</span> <span class="n">new_attributes</span><span class="p">},</span> <span class="n">parent_group</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Wrapper.update_property">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.update_property">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">apply_to_all</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates a property of the HDF5 file given a path to the dataset or group, the name of the property and its value.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the property to update.</span>
<span class="sd">        value : str</span>
<span class="sd">            The value of the property to update.</span>
<span class="sd">        path : str</span>
<span class="sd">            The path of the property to update. Defaults to None sets the property at the root level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the path is not specified, we set it to the root of the file</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;Brillouin&quot;</span>
        
        <span class="k">if</span> <span class="n">apply_to_all</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Root&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_children_elements</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WrapperError_ArgumentType</span><span class="p">(</span><span class="s2">&quot;Apply to all elements or not?&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">apply_to_all</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">apply_to_all</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">)</span> <span class="ow">is</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Group</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_dictionary</span><span class="p">({</span><span class="s2">&quot;Attributes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">value</span><span class="p">}},</span> <span class="n">parent_group</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_children_elements</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_property</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">apply_to_all</span> <span class="o">=</span> <span class="n">apply_to_all</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">elif</span> <span class="n">apply_to_all</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">apply_to_all</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_dictionary</span><span class="p">({</span><span class="s2">&quot;Attributes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">value</span><span class="p">}},</span> <span class="n">parent_group</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_dictionary</span><span class="p">({</span><span class="s2">&quot;Attributes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">value</span><span class="p">}},</span> <span class="n">parent_group</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


    <span class="c1">##########################</span>
    <span class="c1">#    Terminal methods    #</span>
    <span class="c1">##########################</span>

<div class="viewcode-block" id="Wrapper.print_structure">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.print_structure">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lvl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prints the structure of the file in the console</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lvl : int, optional</span>
<span class="sd">            The level of indentation, by default 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_structure</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="s2">&quot;Brillouin_type&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="n">e</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|-&quot;</span><span class="o">*</span><span class="n">lvl</span> <span class="o">+</span> <span class="n">e</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="n">dic</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s2">&quot;Brillouin_type&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_metadata</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="n">e</span><span class="p">],</span> <span class="n">lvl</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|-&quot;</span><span class="o">*</span><span class="n">lvl</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|-&quot;</span><span class="o">*</span><span class="p">(</span><span class="n">lvl</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="n">e</span><span class="p">]))</span></div>

    
<div class="viewcode-block" id="Wrapper.print_metadata">
<a class="viewcode-back" href="../../_autosummary/HDF5_BLS.wrapper.html#HDF5_BLS.wrapper.Wrapper.print_metadata">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prints the metadata of a group or dataset in the console taking into account the hierarchy of the file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lvl : int, optional</span>
<span class="sd">            The level of indentation, by default 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;Brillouin&quot;</span>

        <span class="n">dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s2">&quot; : &quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></div>
</div>

    

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Pierre Bouvet.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>