

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HDF5_BLS.wrapper &mdash; HDF5_BLS v0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=34cd777e"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            HDF5_BLS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">HDF5_BLS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">HDF5_BLS.wrapper</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for HDF5_BLS.wrapper</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">load_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_general</span><span class="p">,</span> <span class="n">load_dat_file</span><span class="p">,</span> <span class="n">load_tiff_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">treat</span><span class="w"> </span><span class="kn">import</span> <span class="n">Treat</span>
    
<span class="n">BLS_HDF5_Version</span> <span class="o">=</span> <span class="s2">&quot;0.0&quot;</span>

<div class="viewcode-block" id="WrapperError">
<a class="viewcode-back" href="../../HDF5_BLS.html#HDF5_BLS.wrapper.WrapperError">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">WrapperError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper">
<a class="viewcode-back" href="../../HDF5_BLS.html#HDF5_BLS.wrapper.Wrapper">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Wrapper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This object is used to store data and attributes in a unified structure.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    attributes: dic</span>
<span class="sd">        The attributes of the data</span>
<span class="sd">    data: dic</span>
<span class="sd">        The data arrays (raw data, treated data, abscissa, other measures)</span>
<span class="sd">    data_attributes: dic</span>
<span class="sd">        The attributes specific to an array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">data_attributes</span> <span class="o">=</span> <span class="p">{}):</span> <span class="c1"># Test made</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span> <span class="c1"># Dictionnary storing all the attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="c1"># Dictionnary storing all the datasets or wrapper objects, group &quot;Data&quot; of HDF5 file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span> <span class="o">=</span> <span class="n">data_attributes</span> <span class="c1"># Dictionnary storing all the attributes of all the data elements</span>

<div class="viewcode-block" id="Wrapper.add_hdf5_to_wrapper">
<a class="viewcode-back" href="../../HDF5_BLS.html#HDF5_BLS.wrapper.Wrapper.add_hdf5_to_wrapper">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_hdf5_to_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">parent_group</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds an hdf5 file to the wrapper by specifying in which group the data have to be stored. Default is the &quot;Data&quot; group. When adding the data, the attributes of the HDF5 file are only added to the created group if they are different from the parent&#39;s attribute.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str</span>
<span class="sd">            The filepath of the hdf5 file to add.</span>
<span class="sd">        parent_group : str, optional</span>
<span class="sd">            The parent group where to store the data of the HDF5 file, by default the parent group is the top group &quot;Data&quot;. The format of this group should be &quot;Data.Data_0.Data_0_0&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find the position where to add the HDF5 file</span>
        <span class="n">par</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> 
        <span class="k">if</span> <span class="n">parent_group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">parent_group</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">par</span><span class="p">[</span><span class="n">temp</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wrapper</span><span class="p">()</span>
                <span class="n">par</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
                <span class="n">loc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Getting the i number of Data_i where to store the file</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="sa">f</span><span class="s2">&quot;Data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>

        <span class="c1"># Adding the file to the wrapper</span>
        <span class="n">wrp</span> <span class="o">=</span> <span class="n">load_hdf5_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="n">wrp</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">par</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrp</span></div>


<div class="viewcode-block" id="Wrapper.add_data_group_to_wrapper">
<a class="viewcode-back" href="../../HDF5_BLS.html#HDF5_BLS.wrapper.Wrapper.add_data_group_to_wrapper">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_data_group_to_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">parent_group</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds data to the wrapper by creating a new group.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : np.ndarray</span>
<span class="sd">            The data to add to the wrapper.</span>
<span class="sd">        parent_group : str, optional</span>
<span class="sd">            The parent group where to store the data of the HDF5 file, by default the parent group is the top group &quot;Data&quot;. The format of this group should be &quot;Data.Data_0.Data_0&quot; or &quot;Data/Data_0/Data_0&quot;.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The name of the data group, by default the name is the identifier of the group &quot;Data_i&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find the position where to add the spectrum</span>
        <span class="n">par</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> 
        <span class="k">if</span> <span class="n">parent_group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">parent_group</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">par</span><span class="p">[</span><span class="n">temp</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wrapper</span><span class="p">()</span>
                <span class="n">par</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
                <span class="n">loc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Getting the i number of Data_i where to store the data</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="sa">f</span><span class="s2">&quot;Data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>

        <span class="c1"># Adding the data and the abscissa to the wrapper</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">par</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wrapper</span><span class="p">(</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;Name&quot;</span><span class="p">:</span><span class="n">name</span><span class="p">},</span>
                                   <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Raw_data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">},</span>
                                   <span class="n">data_attributes</span> <span class="o">=</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span> <span class="n">par</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Wrapper.add_data_to_group">
<a class="viewcode-back" href="../../HDF5_BLS.html#HDF5_BLS.wrapper.Wrapper.add_data_to_group">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_data_to_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds an array to an existing data group.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : np.ndarray</span>
<span class="sd">            The data to add to the wrapper.</span>
<span class="sd">        group : str</span>
<span class="sd">            The group where to store the data.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The name of the data group, by default the name is the identifier of the group &quot;Data_i&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find the position where to add the spectrum</span>
        <span class="n">par</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">par</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">data</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">par</span><span class="p">[</span><span class="n">temp</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wrapper</span><span class="p">()</span>
            <span class="n">par</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="n">temp</span><span class="p">]</span>
            <span class="n">loc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Checking the shape of the data</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Raw_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">shape</span><span class="p">,</span> <span class="n">WrapperError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The shape of the data to add to the data object (</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">) is different from the shape of the raw data in the group (</span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>

        <span class="c1"># Getting the i number of Data_i where to store the data</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="sa">f</span><span class="s2">&quot;Raw_data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>

        <span class="c1"># Adding the data to the wrapper</span>
        <span class="n">par</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Raw_data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

        <span class="c1"># Adding the attributes of the data and the abscissa to the wrapper</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">par</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Raw_data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span></div>


<div class="viewcode-block" id="Wrapper.assign_name_all_abscissa">
<a class="viewcode-back" href="../../HDF5_BLS.html#HDF5_BLS.wrapper.Wrapper.assign_name_all_abscissa">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_name_all_abscissa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">abscissa</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds as attributes of the abscissas and the raw data, the names of the abscissas</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        abscissa : str</span>
<span class="sd">            The names of the abscissas</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError</span>
<span class="sd">            If the length of the abscissa is different from the dimensionality of the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Adds the names of the abscissas to the attributes of the Raw data</span>
        <span class="n">abscissa</span> <span class="o">=</span> <span class="n">abscissa</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">abscissa</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Raw_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">WrapperError</span><span class="p">(</span><span class="s2">&quot;The names provided for the abscissa do not match the shape of the raw data&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">abscissa</span><span class="p">):</span> 
            <span class="k">if</span> <span class="ow">not</span> <span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;MEASURE.Abscissa_Names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">abscissa</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Wrapper.assign_name_one_abscissa">
<a class="viewcode-back" href="../../HDF5_BLS.html#HDF5_BLS.wrapper.Wrapper.assign_name_one_abscissa">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_name_one_abscissa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">abscissa_nb</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds as attributes of the abscissas and the raw data, the names of the abscissas</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        abscissa_nb : str</span>
<span class="sd">            The number of the abscissa to rename (&quot;i&quot; or &quot;i-j&quot;)</span>
<span class="sd">        name : str</span>
<span class="sd">            The new name of the abscissa to rename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Adds the names of the abscissas to the attributes of the Raw data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">abscissa_nb</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">abscissa_nb</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">abscissa_nb</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># Adds the names of the abscissas to the attributes of the wrapper</span>
        <span class="n">abscissa</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Raw_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
                <span class="n">abscissa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="n">abscissa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="s2">&quot;Name&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;MEASURE.Abscissa_Names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">abscissa</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.create_abscissa_1D_min_max">
<a class="viewcode-back" href="../../HDF5_BLS.html#HDF5_BLS.wrapper.Wrapper.create_abscissa_1D_min_max">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_abscissa_1D_min_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dimension</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates an 1D abscissa array from a minimal and maximal value</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dimension : int</span>
<span class="sd">            The dimension of the data that we are changing (first dimension is 0)</span>
<span class="sd">        min : float</span>
<span class="sd">            The minimal value of the abscissa range (included)</span>
<span class="sd">        max : float</span>
<span class="sd">            The maximal value of the abscissa range (included)</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The name of the abscissa axis, by default None</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError</span>
<span class="sd">            If the dimension given is higher than the dimension of the data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">dimension</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Raw_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">WrapperError</span><span class="p">(</span><span class="s2">&quot;The dimension provided for the abscissa is too large considering the size of the raw data&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Raw_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">dimension</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

            <span class="n">abscissa</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Raw_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
                    <span class="n">abscissa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>    
                    <span class="n">abscissa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="s2">&quot;Name&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;MEASURE.Abscissa_Names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">abscissa</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wrapper.import_abscissa_1D">
<a class="viewcode-back" href="../../HDF5_BLS.html#HDF5_BLS.wrapper.Wrapper.import_abscissa_1D">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">import_abscissa_1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dimension</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates an abscissa from a minimal and maximal value</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dimension : int</span>
<span class="sd">            The dimension of the data that we are changing (first dimension is 0)</span>
<span class="sd">        filepath : str</span>
<span class="sd">            The filepath containing the values of the abscissa</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The name of the abscissa axis, by default None</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError</span>
<span class="sd">            If the dimension given is higher than the dimension of the data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">dimension</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Raw_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">WrapperError</span><span class="p">(</span><span class="s2">&quot;The dimension provided for the abscissa is too large considering the size of the raw data&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_general</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        
            <span class="n">abscissa</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Raw_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
                    <span class="n">abscissa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>    
                    <span class="n">abscissa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="s2">&quot;Name&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;MEASURE.Abscissa_Names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">abscissa</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Wrapper.import_properties_data">
<a class="viewcode-back" href="../../HDF5_BLS.html#HDF5_BLS.wrapper.Wrapper.import_properties_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">import_properties_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">update</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Imports properties from a CSV file into a dictionary.</span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath_csv : str                           </span>
<span class="sd">            The filepath to the csv storing the properties of the measure. This csv is meant to be made once to store all the properties of the spectrometer and then minimally adjusted to the sample being measured.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self.attributes : dic</span>
<span class="sd">            The dictionnary containing all the attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_file</span><span class="p">:</span>
            <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;FILEPROP&quot;</span><span class="p">,</span> <span class="s2">&quot;SPECTROMETER&quot;</span><span class="p">,</span> <span class="s2">&quot;MEASURE&quot;</span><span class="p">]:</span>
                    <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="Wrapper.save_as_hdf5">
<a class="viewcode-back" href="../../HDF5_BLS.html#HDF5_BLS.wrapper.Wrapper.save_as_hdf5">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_as_hdf5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filepath</span><span class="p">):</span> <span class="c1"># Test made</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves the data and attributes to an HDF5 file.</span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save_filepath : str                           </span>
<span class="sd">            The filepath where to save the hdf5 file</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        WrapperError</span>
<span class="sd">            Raises an error if the file could not be saved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">save_group</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">id_group</span><span class="p">):</span>
            <span class="n">data_group</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">id_group</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">data_group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">dg</span> <span class="o">=</span> <span class="n">data_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">data_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">dg</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">Wrapper</span><span class="p">):</span>
                    <span class="n">save_group</span><span class="p">(</span><span class="n">data_group</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">WrapperError</span><span class="p">(</span><span class="s2">&quot;Cannot add the selected type to HDF5 file&quot;</span><span class="p">)</span>
                

        <span class="c1"># try:</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
            <span class="c1"># Save attributes</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># Create Data group</span>
            <span class="n">data_group</span> <span class="o">=</span> <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>

            <span class="c1"># Save datasets and apply the attributes</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">dg</span> <span class="o">=</span> <span class="n">data_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">Wrapper</span><span class="p">):</span>
                    <span class="n">save_group</span><span class="p">(</span><span class="n">data_group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">WrapperError</span><span class="p">(</span><span class="s2">&quot;Cannot add the selected type to HDF5 file&quot;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">dg</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span></div>
</div>

        <span class="c1"># except:</span>
        <span class="c1">#     raise WrapperError(&quot;The wrapper could not be saved as a HDF5 file&quot;)</span>

<div class="viewcode-block" id="load_hdf5_file">
<a class="viewcode-back" href="../../HDF5_BLS.html#HDF5_BLS.wrapper.load_hdf5_file">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">load_hdf5_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span> <span class="c1"># Test in add_hdf5_to_wrapper</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads HDF5 files</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath : str                           </span>
<span class="sd">        The filepath to the HDF5 file</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    wrp : Wrapper</span>
<span class="sd">        The wrapper associated to the HDF5 file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_group</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads a group from an HDF5 file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        group : HDF5 group</span>
<span class="sd">            The group to load</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Wrapper</span>
<span class="sd">            The wrapper associated to the HDF5 group</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        WrapperError</span>
<span class="sd">            Raises an error if the group is not a group or a dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attributes</span><span class="p">,</span> <span class="n">data_attributes</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="c1"># Iterate over the group&#39;s items</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:]</span> <span class="c1"># If the item is a dataset, add it to the data dictionary</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>  <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_group</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="c1"># If the item is a group, add it to the data dictionary</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="n">WrapperError</span><span class="p">(</span><span class="s2">&quot;Trying to add an object that is neither a group nor a dataset&quot;</span><span class="p">)</span>

            <span class="n">data_attributes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">ka</span><span class="p">,</span> <span class="n">va</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>  <span class="n">data_attributes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ka</span><span class="p">]</span> <span class="o">=</span> <span class="n">va</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="n">attributes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">return</span> <span class="n">Wrapper</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_attributes</span><span class="p">)</span>
     
    <span class="n">attributes</span><span class="p">,</span> <span class="n">data_attributes</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span> 

    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
            <span class="n">attributes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">hdf5_file</span><span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">h5</span> <span class="o">=</span> <span class="n">hdf5_file</span><span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5</span><span class="p">[:]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">_hl</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_group</span><span class="p">(</span><span class="n">h5</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="n">WrapperError</span><span class="p">(</span><span class="s2">&quot;Trying to add an object that is neither a group nor a dataset&quot;</span><span class="p">)</span>
            
            <span class="n">data_attributes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">ka</span><span class="p">,</span> <span class="n">va</span> <span class="ow">in</span> <span class="n">h5</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="n">data_attributes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ka</span><span class="p">]</span> <span class="o">=</span> <span class="n">va</span>

    <span class="k">return</span> <span class="n">Wrapper</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_attributes</span><span class="p">)</span></div>


<div class="viewcode-block" id="merge_wrappers">
<a class="viewcode-back" href="../../HDF5_BLS.html#HDF5_BLS.wrapper.merge_wrappers">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">merge_wrappers</span><span class="p">(</span><span class="n">list_wrappers</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">abscissa_from_attributes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Merges a list of wrappers into a single wrapper, combining their common attributes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        list_wrappers : list of Wrapper objects</span>
<span class="sd">            The list of Wrapper objects to merge into a single Wrapper object.</span>
<span class="sd">        name: None or str, optional</span>
<span class="sd">            The name given to the file resulting of the merging of the wrappers</span>
<span class="sd">        abscissa_from_attributes: None or list of str, optional</span>
<span class="sd">            The name of the attributes from which to extract values to create an abscissa</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attributes : dic</span>
<span class="sd">            The attributes of the merged wrapper</span>
<span class="sd">        data : dic</span>
<span class="sd">            The data of the merged wrapper</span>
<span class="sd">        data_attributes : dic</span>
<span class="sd">            The attributes of the data of the merged wrapper</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initializing the parameters of the new wrapper</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">list_wrappers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">data_attributes</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>

        <span class="c1"># Extracting the common attributes by joining the attributes and deleting the attributes that are not the same for all the wrappers</span>
        <span class="k">for</span> <span class="n">wrp</span> <span class="ow">in</span> <span class="n">list_wrappers</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">old_attributes</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">old_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">wrp</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">v</span><span class="p">:</span> <span class="k">del</span> <span class="n">attributes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        
        <span class="c1"># Creating the new abscissa from the attributes of the wrappers</span>
        <span class="k">if</span> <span class="n">abscissa_from_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">abscissa_from_attributes</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">,</span> <span class="n">WrapperError</span><span class="p">(</span><span class="s2">&quot;The abscissa_from_attributes parameter should be a list of strings&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">abscissa_from_attributes</span><span class="p">):</span>
                <span class="n">ab_temp</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrp</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">ab</span><span class="p">]</span> <span class="k">for</span> <span class="n">wrp</span> <span class="ow">in</span> <span class="n">list_wrappers</span><span class="p">]</span>

                <span class="k">try</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ab_temp</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ab_temp</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

                <span class="n">data_attributes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Abscissa_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">ab</span><span class="p">}</span>
        
        <span class="c1"># Adding the wrappers to the &quot;Data&quot; of the parent wrapper</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">wrp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_wrappers</span><span class="p">):</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">wrp</span><span class="p">)</span>
        
        <span class="c1"># Adding the name of the new wrapper</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="k">return</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_attributes</span></div>


<div class="viewcode-block" id="add_data_to_wrapper">
<a class="viewcode-back" href="../../HDF5_BLS.html#HDF5_BLS.wrapper.add_data_to_wrapper">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_data_to_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">data_attributes</span><span class="p">,</span> <span class="n">abscissa_from_attributes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add data from a file to a wrapper</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wrapper : Wrapper</span>
<span class="sd">        The wrapper to add the data to</span>
<span class="sd">    file_path : str</span>
<span class="sd">        The path to the file to add</span>
<span class="sd">    data_attributes : dict</span>
<span class="sd">        The attributes of the data to add</span>
<span class="sd">    abscissa_from_attributes : list</span>
<span class="sd">        The attributes to use as abscissa</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Opening the file</span>
    <span class="n">wrp</span> <span class="o">=</span> <span class="n">Wrapper</span><span class="p">()</span>
    <span class="n">wrp</span><span class="o">.</span><span class="n">open_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    
    <span class="c1"># Adding the attributes</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">data_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">data_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">wrapper</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attribute </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> already exists in the wrapper&quot;</span><span class="p">)</span>
            
    <span class="c1"># Adding the data</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">wrp</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">wrapper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> already exists in the wrapper&quot;</span><span class="p">)</span>
            
    <span class="c1"># Adding the abscissa</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">wrp</span><span class="o">.</span><span class="n">data_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">data_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">wrapper</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attribute </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> already exists in the wrapper&quot;</span><span class="p">)</span>
            
    <span class="c1"># Adding the abscissa</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">wrp</span><span class="o">.</span><span class="n">data_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">data_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">wrapper</span><span class="o">.</span><span class="n">data_attributes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attribute </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> already exists in the wrapper&quot;</span><span class="p">)</span>    
            
    <span class="k">return</span> <span class="n">wrapper</span>       </div>


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Pierre Bouvet.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>